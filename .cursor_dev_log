## [2026-01-07 14:40] Fix Invite Route & Infinite Loading
- **Goal**: Fix "Already Joined" infinite loading bug and I18n SyntaxError in RoomStore.
- **Changes**:
  - `frontend/vue-ezchat/src/assets/main.css`: Added z-index override (100000) for `.el-overlay`.
  - `frontend/vue-ezchat/src/stores/roomStore.ts`: Reverted to blocking `showAlertDialog`, fixed `useI18n` usage.
  - `frontend/vue-ezchat/src/utils/request.ts`: Removed redundant error handling.
  - `frontend/vue-ezchat/src/router/index.ts`: Updated invite route guard.
  - `frontend/vue-ezchat/src/hooks/chat/join/useJoinInput.ts`: Fixed `useI18n` usage outside setup.
  
## [2026-01-07 14:45] Internationalize Join Chat Success Message
- **Goal**: Internationalize success message in router invite validation
- **Changes**:
  - [MODIFY] `router/index.ts` (line 204):
    - Internationalized success message: `ElMessage.success('Join chat successfully')` → `ElMessage.success(t('api.join_chat_success'))`
  - [MODIFY] `i18n/locales/en.json`:
    - Added `join_chat_success` translation key: "Join chat successfully"
  - [MODIFY] `i18n/locales/zh.json`:
    - Added `join_chat_success` translation key: "成功加入聊天室"
  - [MODIFY] `i18n/locales/ja.json`:
    - Added `join_chat_success` translation key: "チャットに参加しました"
  - [MODIFY] `i18n/locales/ko.json`:
    - Added `join_chat_success` translation key: "채팅에 참여했습니다"
  - [MODIFY] `i18n/locales/zh-tw.json`:
    - Added `join_chat_success` translation key: "成功加入聊天室"
  
## [2026-01-07 14:50] Complete Globalization of Invite Verification Text
- **Goal**: Fully internationalize invite verification loading text
- **Changes**:
  - [MODIFY] `router/index.ts` (line 147):
    - Removed fallback text: `t('common.verifying_invitation') || 'Verifying invitation...'` → `t('common.verifying_invitation')`
  - [MODIFY] `i18n/locales/en.json`:
    - Added `verifying_invitation` translation key: "Verifying invitation..."
  - [MODIFY] `i18n/locales/zh.json`:
    - Added `verifying_invitation` translation key: "验证邀请中..."
  - [MODIFY] `i18n/locales/ja.json`:
    - Added `verifying_invitation` translation key: "招待を確認中..."
  - [MODIFY] `i18n/locales/ko.json`:
    - Added `verifying_invitation` translation key: "초대 확인 중..."
  - [MODIFY] `i18n/locales/zh-tw.json`:
    - Added `verifying_invitation` translation key: "驗證邀請中..."
## [2026-01-07 15:52] Refactor Invite Route Logic
- **Goal**: Extract complex invite verification logic from router guard to a dedicated service service.
- **Changes**:
  - NEW `frontend/vue-ezchat/src/services/inviteService.ts`: Contains `processInviteRoute` logic.
  - MOD `frontend/vue-ezchat/src/router/index.ts`: Replaced inline logic with `processInviteRoute` call.
  
## [2026-01-07 15:55] Internationalize Image Upload Error Message
- **Goal**: Internationalize Japanese error message in useUpload hook
- **Changes**:
  - [MODIFY] `hooks/useUpload.ts`:
    - Added i18n import: `import i18n from '@/i18n'`
    - Added t function inside customUpload method: `const { t } = i18n.global`
    - Internationalized error message: `ElMessage.error('画像のアップロードに失敗しました')` → `ElMessage.error(t('api.image_upload_failed'))`
  - [MODIFY] `i18n/locales/en.json`:
    - Added `image_upload_failed` translation key: "Image upload failed."
  - [MODIFY] `i18n/locales/zh.json`:
    - Added `image_upload_failed` translation key: "图片上传失败。"
  - [MODIFY] `i18n/locales/ja.json`:
    - Added `image_upload_failed` translation key: "画像のアップロードに失敗しました。"
  - [MODIFY] `i18n/locales/ko.json`:
    - Added `image_upload_failed` translation key: "이미지 업로드에 실패했습니다。"
  - [MODIFY] `i18n/locales/zh-tw.json`:
    - Added `image_upload_failed` translation key: "圖片上傳失敗。"
  
## [2026-01-07 16:00] Fix Missing Translation Key in GuestAside
- **Goal**: Fix missing 'aside.current_chat' and 'aside.no_chat' translation key warnings
- **Changes**:
  - [MODIFY] `views/layout/components/GuestAside.vue` (line 165):
    - Removed fallback text: `t('aside.current_chat', '当前会话')` → `t('aside.current_chat')`
  - [MODIFY] `views/layout/components/GuestAside.vue` (line 172):
    - Removed fallback text: `t('aside.no_chat', '暂无会话')` → `t('aside.no_chat')`
  - [MODIFY] `i18n/locales/en.json`:
    - Added `current_chat` translation key in aside section: "Current Chat"
    - Added `no_chat` translation key in aside section: "No chat"
  - [MODIFY] `i18n/locales/zh.json`:
    - Added `current_chat` translation key in aside section: "当前会话"
    - Added `no_chat` translation key in aside section: "暂无会话"
  - [MODIFY] `i18n/locales/ja.json`:
    - Added `current_chat` translation key in aside section: "現在のチャット"
    - Added `no_chat` translation key in aside section: "チャットがありません"
  - [MODIFY] `i18n/locales/ko.json`:
    - Added `current_chat` translation key in aside section: "현재 채팅"
    - Added `no_chat` translation key in aside section: "채팅이 없습니다"
  - [MODIFY] `i18n/locales/zh-tw.json`:
    - Added `current_chat` translation key in aside section: "當前會話"
    - Added `no_chat` translation key in aside section: "暫無會話"
  
## [2026-01-07 16:10] Complete Globalization of useGuestJoin Hook
- **Goal**: Internationalize all hardcoded English messages in useGuestJoin hook
- **Changes**:
  - [MODIFY] `hooks/chat/join/useGuestJoin.ts`:
    - Line 182: `ElMessage.warning('Room ID is missing in URL')` → `ElMessage.warning(t('chat.room_id_missing'))`
    - Line 188: `ElMessage.warning('Invalid Room ID format in URL')` → `ElMessage.warning(t('chat.invalid_room_id_format'))`
    - Line 195: `ElMessage.warning('Room code mismatch')` → `ElMessage.warning(t('chat.room_code_mismatch'))`
    - Line 202: `ElMessage.warning(t('validation.nickname_invalid') || 'Invalid Nickname')` → `ElMessage.warning(t('validation.nickname_invalid'))`
    - Line 210: `ElMessage.error('Validation info expired, please restart')` → `ElMessage.error(t('chat.validation_info_expired'))`
    - Line 223: `ElMessage.warning('Avatar upload failed, using default')` → `ElMessage.warning(t('chat.avatar_upload_failed'))`
    - Line 233: `ElMessage.error('Target chat code is missing')` → `ElMessage.error(t('chat.target_chat_code_missing'))`
    - Line 255: `ElMessage.error('Invalid validation info')` → `ElMessage.error(t('chat.invalid_validation_info'))`
    - Line 265: `ElMessage.success(t('chat.join_success') || 'Joined successfully')` → `ElMessage.success(t('chat.join_success'))`
  - [MODIFY] `i18n/locales/en.json`:
    - Added `room_id_missing`: "Room ID is missing in URL"
    - Added `invalid_room_id_format`: "Invalid Room ID format in URL"
    - Added `room_code_mismatch`: "Room code mismatch"
    - Added `validation_info_expired`: "Validation info expired, please restart"
    - Added `avatar_upload_failed`: "Avatar upload failed, using default"
    - Added `target_chat_code_missing`: "Target chat code is missing"
    - Added `invalid_validation_info`: "Invalid validation info"
  - [MODIFY] `i18n/locales/zh.json`:
    - Added `room_id_missing`: "URL中缺少房间ID"
    - Added `invalid_room_id_format`: "URL中的房间ID格式无效"
    - Added `room_code_mismatch`: "房间代码不匹配"
    - Added `validation_info_expired`: "验证信息已过期，请重新开始"
    - Added `avatar_upload_failed`: "头像上传失败，使用默认头像"
    - Added `target_chat_code_missing`: "目标聊天代码缺失"
    - Added `invalid_validation_info`: "验证信息无效"
  - [MODIFY] `i18n/locales/ja.json`:
    - Added `room_id_missing`: "URLにルームIDがありません"
    - Added `invalid_room_id_format`: "URLのルームID形式が無効です"
    - Added `room_code_mismatch`: "ルームコードが一致しません"
    - Added `validation_info_expired`: "検証情報の有効期限が切れました。再開してください"
    - Added `avatar_upload_failed`: "アバターのアップロードに失敗しました。デフォルトを使用します"
    - Added `target_chat_code_missing`: "ターゲットチャットコードがありません"
    - Added `invalid_validation_info`: "検証情報が無効です"
  - [MODIFY] `i18n/locales/ko.json`:
    - Added `room_id_missing`: "URL에 룸 ID가 없습니다"
    - Added `invalid_room_id_format`: "URL의 룸 ID 형식이 잘못되었습니다"
    - Added `room_code_mismatch`: "룸 코드가 일치하지 않습니다"
    - Added `validation_info_expired`: "검증 정보가 만료되었습니다. 다시 시작해 주세요"
    - Added `avatar_upload_failed`: "아바타 업로드에 실패했습니다. 기본값을 사용합니다"
    - Added `target_chat_code_missing`: "대상 채팅 코드가 없습니다"
    - Added `invalid_validation_info`: "검증 정보가 유효하지 않습니다"
  - [MODIFY] `i18n/locales/zh-tw.json`:
    - Added `room_id_missing`: "URL中缺少房間ID"
    - Added `invalid_room_id_format`: "URL中的房間ID格式無效"
    - Added `room_code_mismatch`: "房間代碼不匹配"
    - Added `validation_info_expired`: "驗證資訊已過期，請重新開始"
    - Added `avatar_upload_failed`: "頭像上傳失敗，使用預設頭像"
    - Added `target_chat_code_missing`: "目標聊天代碼缺失"
    - Added `invalid_validation_info`: "驗證資訊無效"
## [2026-01-07 17:31] Fix Typescript Error in messageStore.ts
- **Goal**: Resolve 'Pick<Message, images>' error by decoupling image processing from strict Message union types.
- **Changes**: Modified 'sendMessage' in messageStore.ts to iterate image array directly.
## [2026-01-07 17:36] Refactor WebSocket Protocol
- **Goal**: Decouple Message types and use Status Codes (1001, 3001) for clearer protocol distinction.
- **Changes**: Updated WebSocketResult.java, ChatServiceImpl.java, WebSocketServer.java, type/index.ts, useWebsocket.ts.
  
## [2026-01-07 17:45] Fix TypeScript Error: Missing 'images' Property in Message Union Type
- **Goal**: Fix TypeScript error where accessing `images` property on `Message` union type fails because some message types (RoomCreatedMessage, MemberJoinMessage) don't have this property.
- **Changes**:
  - [MODIFY] `type/index.ts`:
    - Added new type `InputMessage = TextMessage | ImageMessage | MixedMessage` for input content
    - This type only includes message types that have `images` property (even if it's `never[]`)
  - [MODIFY] `hooks/useChatInput.ts`:
    - Changed `inputContent` type from `Message` to `InputMessage`
    - Updated import statement to use `InputMessage` instead of `Message`
  - **Explanation**: The `Message` union type includes system messages (RoomCreatedMessage, MemberJoinMessage) that don't have `images` property. By creating a dedicated `InputMessage` type that only includes user-inputtable message types, we ensure type safety when accessing `inputContent.images` in the template.
  
## [2026-01-07 17:50] Fix TypeScript Error: Missing 'images' Property in MessageItem Component
- **Goal**: Fix TypeScript error where accessing `images` property on `Message` union type in MessageItem component fails because some message types don't have this property.
- **Changes**:
  - [MODIFY] `views/chat/components/MessageItem.vue`:
    - Added type guard function `hasImages` to check if a message has `images` property
    - Added computed property `messageImages` that safely returns `Image[]` using the type guard
    - Updated all usages of `props.msg.images` to use `messageImages.value` (in script) or `messageImages` (in template)
    - Updated `openViewer` function to use `messageImages.value`
    - Updated `watchEffect` to use `messageImages.value`
    - Updated template to use `messageImages` instead of `msg.images`
  - **Explanation**: The `Message` union type includes system messages (RoomCreatedMessage, MemberJoinMessage) that don't have `images` property. By using a type guard function and computed property, we safely access `images` only when it exists, ensuring type safety throughout the component.
  
## [2026-01-07 17:55] Move Type Guard Function to validators.ts
- **Goal**: Move `hasImages` type guard function from MessageItem.vue to validators.ts for better code organization and reusability.
- **Changes**:
  - [MODIFY] `utils/validators.ts`:
    - Added type imports: `Message`, `TextMessage`, `ImageMessage`, `MixedMessage`
    - Added `hasImages` type guard function to check if a message has `images` property
  - [MODIFY] `views/chat/components/MessageItem.vue`:
    - Removed local `hasImages` function definition
    - Added import: `import {hasImages} from '@/utils/validators'`
    - Removed unused type imports: `TextMessage`, `ImageMessage`, `MixedMessage`
  - **Explanation**: Moving type guard functions to a centralized validators.ts file improves code organization and makes them reusable across the codebase.
  
## [2026-01-07 18:00] Complete Globalization of System Messages
- **Goal**: Add missing system message translations to all language files
- **Changes**:
  - [MODIFY] `i18n/locales/zh.json`:
    - Added `system` section with:
      - `room_created`: "房间已创建"
      - `member_joined`: "{0} 加入了群聊"
      - `guest_joined`: "{0} 以访客身份加入了群聊"
  - [MODIFY] `i18n/locales/en.json`:
    - Updated `system` section with:
      - `room_created`: "Room created"
      - `member_joined`: "{0} joined the group"
      - `guest_joined`: "{0} joined the group as a guest"
  - [MODIFY] `i18n/locales/ja.json`:
    - Added `system` section with:
      - `room_created`: "ルームが作成されました"
      - `member_joined`: "{0} がグループに参加しました"
      - `guest_joined`: "{0} がゲストとしてグループに参加しました"
  - [MODIFY] `i18n/locales/ko.json`:
    - Added `system` section with:
      - `room_created`: "룸이 생성되었습니다"
      - `member_joined`: "{0} 님이 그룹에 참여했습니다"
      - `guest_joined`: "{0} 님이 게스트로 그룹에 참여했습니다"
  - [MODIFY] `i18n/locales/zh-tw.json`:
    - Added `system` section with:
      - `room_created`: "房間已建立"
      - `member_joined`: "{0} 加入了群聊"
      - `guest_joined`: "{0} 以訪客身份加入了群聊"
  - **Explanation**: System messages (room creation, member join, guest join) are now fully internationalized across all supported languages.
## [2026-01-07 17:49] Fix useChatInput TS Error
- **Goal**: Fix "Argument of type 'Image' is not assignable to parameter of type 'never'" error.
- **Changes**: src/hooks/useChatInput.ts (Adjusted inputContent type definition to allow images array in draft state).
## [2026-01-07 17:51] Fix MessageItem Runtime Crash
- **Goal**: Fix "Cannot read properties of null (reading 'forEach')" error in MessageItem.vue.
- **Changes**: src/views/chat/components/MessageItem.vue (Added strict Array.isArray check for messageImages).
## [2026-01-07 17:57] Fix MyBatis BindingException
- **Goal**: Resolve "Invalid bound statement" for UserMapper methods.
- **Changes**: src/main/resources/hal/th50743/mapper/UserMapper.xml (Added XML mappings for getUserById and getUsernameByUserId).
## [2026-01-07 18:04] Fix WebSocket Parse Error
- **Goal**: Fix "SyntaxError: Unexpected token 'm'" when parsing ACK messages.
- **Changes**: src/WS/useWebsocket.ts (Updated parseData to safely handle non-JSON strings).
## [2026-01-07 18:15] Relax WebSocket Validation
- **Goal**: Fix message loss due to overly strict type guarding in useWebsocket.ts.
- **Changes**: 
  - src/WS/useWebsocket.ts (Allowed loose  payload).
  - src/stores/websocketStore.ts (Accepted  payload and cast to ).
## [2026-01-07 18:21] Implement Runtime Validation
- **Goal**: Move strict message validation from transport layer to business layer.
- **Changes**:
  - src/utils/validators.ts (Added isValidMessage type guard).
  - src/stores/websocketStore.ts (Removed dangerous cast, passing raw data).
  - src/stores/messageStore.ts (Implemented runtime validation using validMessage).
## [2026-01-07 18:32] Fix Room Member Hydration Bug
- **Goal**: Fix insufficient member list loading issue caused by partial hydration.
- **Changes**: src/stores/roomStore.ts (Updated addRoomMember to only append to already populated lists).
## [2026-01-07 18:39] Debug Backend Payload
- **Goal**: Verify if  payload actually contains the  object.
- **Changes**: backend/EZChat-app/src/main/java/hal/th50743/service/impl/ChatServiceImpl.java (Added INFO logs).
## [2026-01-07 18:41] Debug Join Validation
- **Goal**: Fix INVITE_URL_REQUIRED error when joining via password mode.
- **Changes**: frontend/vue-ezchat/src/hooks/chat/join/useJoinInput.ts (Added debug logs).
## [2026-01-07 18:43] Fix Join Validation UX
- **Goal**: Handle raw validation errors gracefully with toast messages instead of UNKNOWN system errors.
- **Changes**: frontend/vue-ezchat/src/hooks/chat/join/useJoinInput.ts.

## [2026-01-07 18:45] Fix TS Error in useJoinInput
- **Goal**: Resolve "Type 'string | undefined' is not assignable" error.
- **Changes**: 
  - `frontend/vue-ezchat/src/hooks/chat/join/useJoinInput.ts` (Refactored error handling in `validateAndGetPayload`)

## [2026-01-07 19:02] Refactor Backend Service Logic
- **Goal**: Move Chat Join business logic from `AuthService` to `ChatService`.
- **Changes**: 
  - `backend/EZChat-app/src/main/java/hal/th50743/service/impl/AuthServiceImpl.java` (Refactored `joinChat` to delegate to `chatService.join`, removed unused mappers)

## [2026-01-07 19:18] Fix Broadcast Logic
- **Goal**: Fix guest join broadcast not delivering.
- **Changes**: 
  - `backend/EZChat-app/src/main/java/hal/th50743/service/impl/ChatServiceImpl.java` (Switched to `getChatMemberListByChatId` to avoid `UserId` filtering issues)

## [2026-01-07 19:24] Fix Guest System Message Logic
- **Goal**: Fix guest join system message not being persisted.
- **Changes**: 
  - `backend/EZChat-app/src/main/java/hal/th50743/service/impl/ChatServiceImpl.java` (Refactored `isGuest` check to be more efficient, handled `assetIds` null safety)

## [2026-01-07 19:29] Sync Member Avatar
- **Goal**: Ensure new chat member avatar is fetched before adding to list.
- **Changes**: 
  - `frontend/vue-ezchat/src/stores/websocketStore.ts` (Modified `onChatMemberAdd` to await `imageStore.ensureThumbBlobUrl`)

## [2026-01-07 19:54] Fix Avatar Pre-fetch Compatibility
- **Goal**: Fix avatar pre-fetch skipping due to legacy field names (`objectName` vs `imageName`).
- **Changes**: 
  - `frontend/vue-ezchat/src/stores/websocketStore.ts` (Added compatibility check for `objectName`/`objectUrl` and normalized them before calling `ensureThumbBlobUrl`)

## [2026-01-07 20:15] 为 WebSocketServer.java 添加详细中文注释
|- **Goal**: 为 WebSocket 服务端点添加全面、详细的中文注释，提高代码可读性和维护性
|- **Changes**:
  - `backend/EZChat-app/src/main/java/hal/th50743/ws/WebSocketServer.java`:
    - 添加了所有导入包的详细注释说明
    - 扩展了类级别的详细功能描述和设计说明
    - 为所有成员变量添加了详细的作用和生命周期说明
    - 为每个方法添加了完整的 Javadoc 注释，包括参数说明、返回值、异常处理
    - 在关键业务逻辑处添加了行内注释，解释复杂逻辑
    - 详细说明了防抖机制、线程安全考虑和性能优化点
    - 添加了异常处理策略的业务逻辑说明
    - 统一了注释格式，符合项目编码规范

## [2026-01-07 20:30] 为 ChatServiceImpl.java 添加详细中文注释
|- **Goal**: 为聊天服务核心实现类添加全面、详细的中文注释，提高代码可读性和维护性
|- **Changes**:
  - `backend/EZChat-app/src/main/java/hal/th50743/service/impl/ChatServiceImpl.java`:
    - 添加了所有导入包的详细注释说明
    - 为所有依赖注入组件添加了详细的作用说明
    - 为缺少注释的方法添加了完整的Javadoc文档
    - 详细说明了事务管理策略和回滚机制
    - 添加了关键业务逻辑的行内注释和解释
    - 完善了异常处理和安全考虑的注释说明
    - 统一了注释格式和深度，符合项目编码规范
## [2026-01-07 21:18] Refactor ChatServiceImpl Decoupling
- **Goal**: Extract ChatMember logic and MinIO dependencies from ChatServiceImpl to new ChatMemberAssembler.
- **Changes**: 
  - Created `backend/EZChat-app/src/main/java/hal/th50743/assembler/ChatMemberAssembler.java`
  - Modified `backend/EZChat-app/src/main/java/hal/th50743/assembler/ChatAssembler.java`
  - Modified `backend/EZChat-app/src/main/java/hal/th50743/service/impl/ChatServiceImpl.java`
## [2026-01-07 21:20] Fix Syntax Error in GuestAside.vue
- **Goal**: Fix missing style end tag
- **Changes**: 
  - GuestAside.vue (Appended </style>)

## [2026-01-07 21:30] Update Documentation
- **Goal**: Synchronize README with recent code changes (WebSocket protocol, I18n).
- **Changes**:
  - [MODIFY] `README.md`: Updated Features, WebSocket Protocol section, added Changelog.

## [2026-01-07 21:30] Update Documentation (Debounce)
- **Goal**: Add 'Presence Debounce' feature to README.
- **Changes**:
  - [MODIFY] `README.md`: Added debounce description in Features and Changelog.

## [2026-01-08 06:15] Refactor UserAssembler
- **Goal**: Reuse ImageUtils logic for image URL generation to ensure consistency and reduce duplication.
- **Changes**:
  - [MODIFY] `backend/EZChat-app/src/main/java/hal/th50743/assembler/UserAssembler.java`: Replaced manual MinioOSSResult handling with `ImageUtils.buildImage`. Cleaned up imports.

## [2026-01-08 06:17] Refactor ChatMemberAssembler
- **Goal**: Consolidate avatar image building logic and reuse `ImageUtils.buildImage`.
- **Changes**:
  - [MODIFY] `backend/EZChat-app/src/main/java/hal/th50743/assembler/ChatMemberAssembler.java`: Extracted `buildAvatar` private method. Refactored `toChatMemberVO` methods to use it.

## [2026-01-08 06:33] Add Logging Configuration
- **Goal**: Configure profile-specific logging for Dev (Console) and Prod (File).
- **Changes**:
  - [NEW] `backend/EZChat-app/src/main/resources/logback-spring.xml`: Configured INFO/ERROR file appenders and color console output.

## [2026-01-08 06:35] Add Usage Audit Infrastructure
- **Goal**: Create infrastructure for recording user operation logs.
- **Changes**:
  - [NEW] `OperationLog.java`: POJO for audit logs.
  - [NEW] `OperationLogMapper.java`: MyBatis mapper interface.
  - [NEW] `OperationLogMapper.xml`: XML mapping for insert operation.

## [2026-01-08 06:40] Implement Audit Log AOP
- **Goal**: Implement Aspect-oriented audit logging with async saving.
- **Changes**:
  - [NEW] `LogAspect.java`: Aspect to intercept methods, parse SpEL, and capture context.
  - [NEW] `AsyncLogService.java`: Async service to insert logs.
  - [NEW] `LogRecord.java`: Annotation definition.
  - [MODIFY] `EzChatAppApplication.java`: Enabled Async support.

## [2026-01-08 06:45] Fix LogAspect Compilation Error
- **Goal**: Fix 'AfterReturning cannot be resolved' error in LogAspect.java
- **Changes**: added spring-boot-starter-aop to backend/EZChat-app/pom.xml
## [2026-01-08 08:21] Refactor GuestAside Layout
- **Goal**: Move Nickname and Bio inputs to the left side (Profile Section) and keep only Auth fields on the right.
- **Changes**: `GuestAside.vue` (Moved fields, updated form structure).
## [2026-01-08 08:25] Refactor GuestAside Layout (Polish)
- **Goal**: Address cramped UI by widening dialog and increasing spacing.
- **Changes**: `GuestAside.vue` (Dialog width 750px->850px, Left Col 260px->320px, Increased gaps).
## [2026-01-08 08:26] Refactor GuestAside Layout (Title & Labels)
- **Goal**: Improve layout logic by moving title to context area (right) and clearer labels on left.
- **Changes**: `GuestAside.vue` (Moved title to right col, added labels to nick/bio).
## [2026-01-08 08:30] Unify Dialog Close Button Style
- **Goal**: Standardize close button appearance and hover effects across all dialogs for consistency.
- **Changes**: 
  - `GuestAside.vue` (Added hover rotation).
  - `JoinChatDialog.vue` (Simplified positioning logic).
  - `CreateChatDialog.vue` (Unified structure/styles).
## [2026-01-08 08:34] Globalize Dialog Close Button
- **Goal**: Move close button styles to specific global CSS `ez-dialog.css` to remove duplication and ensure consistency.
- **Changes**: 
  - `ez-dialog.css` (Added `.ez-close-btn`).
  - Refactored `GuestAside`, `CreateChatDialog`, `JoinChatDialog` to use new class.
  - Refactored `RightCard`, `LeftCard` to use new class and added consistent positioning.
## [2026-01-08 08:36] Fix Close Button Background
- **Goal**: Fix opaque background on close buttons (especially visible on Glass UI).
- **Changes**: `ez-dialog.css` (Set `.ez-close-btn` background to `transparent`).
## [2026-01-08 08:40] Fix CreateChatDialog Close Button
- **Goal**: Fix broken close button style in `CreateChatDialog.vue` (was missing styles).
- **Changes**: `CreateChatDialog.vue` (Updated template to use `ez-close-btn` global class).
## [2026-01-08 08:41] Align Progress Bar
- **Goal**: Align progress bar vertically with the close button in `CreateChatDialog`.
- **Changes**: `CreateChatDialog.vue` (Increased header padding to 30px).
## [2026-01-08 08:43] Optimize Margins in CreateChatDialog
- **Goal**: Unify horizontal spacing/margins.
- **Changes**: `CreateChatDialog.vue` (Unified `.progress-section` padding to 32px to match header/body).
## [2026-01-08 08:44] Reduce Margins in CreateChatDialog
- **Goal**: Unify margins with other dialogs (reduced from 32px/30px to 24px/20px).
- **Changes**: `CreateChatDialog.vue` (Updated paddings to 24px side, 20px top).
## [2026-01-08 08:45] Align Close Button in CreateChatDialog
- **Goal**: Align close button with progress bar (which shifted due to margin reduction).
- **Changes**: `CreateChatDialog.vue` (Overrode global positional styles locally to `top: 6px; right: 12px`).
## [2026-01-08 08:46] Shorten Progress Bar
- **Goal**: Shorten progress bar to prevent overlap with the close button.
- **Changes**: `CreateChatDialog.vue` (Increased horizontal padding to 56px).
## [2026-01-08 08:48] Narrow CreateChatDialog
- **Goal**: Make CreateChatDialog narrower (match JoinChatDialog).
- **Changes**: `CreateChatDialog.vue` (Reduced width to 480px).
## [2026-01-08 08:48] Adjust CreateChatDialog Width
- **Goal**: Find middle ground for width (480px was too narrow).
- **Changes**: `CreateChatDialog.vue` (Increased width to 520px).
## [2026-01-08 08:50] Refactor AlertDialog Styles
- **Goal**: Unify AlertDialog visual style with other dialogs.
- **Changes**: `ez-dialog.css` (Updated `.ez-dialog` to use glassmorphism vars, increased radius/padding).
## [2026-01-08 08:53] Refactor AlertDialog Cancel Button
- **Goal**: Match Cancel button style with GuestAside (transparent).
- **Changes**: `ez-dialog.css` (Updated `.ez-dialog-btn` to transparent ghost style).
## [2026-01-08 08:56] Style AlertDialog Buttons as Ghost
- **Goal**: Make both buttons in AlertDialog behave like Close Button (Transparent -> Hover BG).
- **Changes**: `ez-dialog.css` (Cancel: Gray Hover; Primary: Light Blue Hover).
## [2026-01-08 08:58] Revert Primary Button & Sync Cancel
- **Goal**: Revert Confirm button to solid; Sync Cancel buttons (AlertDialog & GuestAside) to Close Button style.
- **Changes**: 
  - `ez-dialog.css`: Reverted Primary to Solid.
  - `GuestAside.vue`: Updated `.cancel-btn` hover to use `var(--el-border-color-light)`.
## [2026-01-08 08:59] Revert Primary Button in ez-dialog.css
- **Goal**: Revert Confirm button to solid filled style.
- **Changes**: `ez-dialog.css` (Confirm button solid colored).
## [2026-01-08 09:02] Style Danger Button as Solid Red
- **Goal**: Make Danger button Solid Red (not soft) for better aesthetics.
- **Changes**: `ez-dialog.css` (Updated Danger button to solid `var(--el-color-danger)`).
## [2026-01-08 09:03] Unify Notification Close Button
- **Goal**: Apply global Close Button style to Notifications.
- **Changes**: `ez-dialog.css` (Updated `.el-notification__closeBtn` to match `.ez-close-btn` metrics and hover behavior).
## [2026-01-08 09:07] Create UserAvatar Component
- **Goal**: Create a unified component for avatar display and upload preview.
- **Changes**: `UserAvatar.vue` (New component with 3-stage fallback, editable mode, and unified glass styles).
## [2026-01-08 09:10] Integrate UserAvatar in GuestAside
- **Goal**: Use UserAvatar component for GuestAside upgrade dialog.
- **Changes**: `GuestAside.vue` (Imported UserAvatar, replaced inline upload preview logic).
## [2026-01-08 09:12] Integrate UserAvatar in CreateChatDialog
- **Goal**: Use UserAvatar component for Create Chat dialog.
- **Changes**: `CreateChatDialog.vue` (Imported UserAvatar, replaced inline upload preview logic).
## [2026-01-08 09:12] Integrate UserAvatar in Lists
- **Goal**: Replace SmartAvatar with UserAvatar across list components.
- **Changes**: `MessageItem.vue`, `ChatItem.vue`, `ChatMemberListItem.vue`, `UserItem.vue`.
## [2026-01-08 09:18] Refactor GuestAside Password Inputs
- **Goal**: Use shared PasswordInput component in GuestAside upgrade dialog.
- **Changes**: `GuestAside.vue` (Replaced el-input with PasswordInput).
## [2026-01-08 09:20] Refactor GuestAside Validation
- **Goal**: Use standardized validators from `validators.ts`.
- **Changes**: `GuestAside.vue` (Updated rules for username, password, nickname).
## [2026-01-08 09:33] Unify CUD Naming & Auto-Log via LogAspect
 CUD 命名规范，改用 Pointcut 自动拦截日志- **Goal**: 统一 Service/Mapper 
- **Changes**:
  - `ChatMapper.insertChat` → `addChat`
  - `AssetMapper.insert` → `add`
  - `ChatInviteMapper.insert` → `add`
  - `OperationLogMapper.insert` → `add`
  - `MessageService.saveMessage` → `addMessage`
  - `AsyncLogService.saveLog` → `addLog`
  - `LogAspect`: 改用 Pointcut 自动拦截 `*ServiceImpl.add*/update*/delete*`
  - 删除 `@LogRecord` 注解

## [2026-01-08 09:55] Tiered Method Naming Refactoring
- **Goal**: 统一 Mapper/Service 层方法命名规范
- **Changes**:
  - Mapper 层：37 方法重命名 (add→insert, get/find→select)
  - 7 个 XML Mapper：全部更新
  - ServiceImpl：约 50 处调用全部更新
  - LogAspect：更新 Pointcut (create/add/save/update/remove/delete)


## [2026-01-08 11:35] Fix WebSocket EOFException
- **Goal**: Handle `java.io.EOFException` explicitly to prevent error logs when clients disconnect abruptly.
- **Changes**: `WebSocketServer.java` (Added `@OnError` handler).

## [2026-01-08 11:42] Fix Password Warning
- **Goal**: Suppress `passwordConfirm` validation warnings in console.
- **Changes**: `ErrorHandler.ts` (Added field to suppression list).
## [2026-01-08 12:44] Update Message Sequence Logic (Backend)
- **Goal**: Implement `seq_id` logic for messages to support ordered chat history as per schema changes.
- **Changes**:
  - `Message.java`, `MessageVO.java`: Added `seqId` field.
  - `MessageMapper.java`: Added `updateChatSequence` and `getCurrentSequence`.
  - `MessageMapper.xml`: Implemented sequence handling SQL and updated queries.
  - `MessageServiceImpl.java`: Updated `addMessage` to generating sequence ID using transaction.
  - `WebSocketServer.java`: Fixed `MessageVO` constructor call (seqId set to null for now).
## [2026-01-08 12:52] Update Frontend Message Types
- **Goal**: Support `seqId` field in frontend to align with backend schema.
- **Changes**:
  - `src/type/index.ts`: Added `seqId?: number` to `BaseMessage`.
  - `src/utils/validators.ts`: Updated `isValidMessage` to allow checking `seqId`.
## [2026-01-08 13:03] Implement Frontend Message Sorting by seqId
- **Goal**: Ensure reliable message ordering using the new `seqId` field.
- **Changes**:
  - `src/stores/messageStore.ts`: Added `sortMessages` helper.
  - `getMessageList`: Applied sorting after fetching/merging messages.
  - `receiveMessage`: Applied sorting after receiving new messages to handle potential out-of-order delivery.
## [2026-01-08 13:05] Optimize Message List Key
- **Goal**: Optimize Vue rendering performance and stability by using `seqId`.
- **Changes**:
  - `src/views/chat/layout/MessageArea.vue`: Updated `v-for` key to `:key="msg.tempId || msg.seqId || ..." `.
## [2026-01-08 13:08] Fix SQL Test Data Order
- **Goal**: Align `create_time` with `seq_id` in `init.sql` test data.
- **Changes**:
  - `backend/EZChat-app/src/main/resources/sql/init.sql`: Updated `generate_test_data` to use `DATE_SUB(NOW(), INTERVAL (50 - j) MINUTE)` instead of random time.
## [2026-01-08 13:13] UI Fix: Message Loading Spinner
- **Goal**: Move loading spinner to the left of the message bubble (for self-sent messages).
- **Changes**:
  - `src/views/chat/components/MessageItem.vue`: Swapped DOM order of `status-indicator` and `message-stack`.
## [2026-01-08 13:22] Implement Sync Messages API
- **Goal**: Provide an API for frontend to fetch missing messages based on `lastSeqId`.
- **Changes**:
  - Created `MessageAssembler.java` to encapsulate message enrichment (asset URLs).
  - `MessageMapper`: Added `selectMessagesAfterSeqId`.
  - `MessageService`: Added `syncMessages` and refactored `getMessagesByChatCode` to use assembler.
  - `MessageController`: Added `GET /message/sync`.
## [2026-01-08 13:35] Refactor Message Paging to SeqId
- **Goal**: Replace timestamp-based pagination with stable seqId-based pagination.
- **Backend Changes**:
  - Refactored `getMessagesByChatCode` to accept `cursorSeqId`.
  - Updated Mapper to query `seq_id < cursor`.
- **Frontend Changes**:
  - Updated `getMessageListApi` to support `cursorSeqId`.
  - Updated `messageStore.ts` to perform pagination using `oldestMessage.seqId`.
## [2026-01-08 13:36] Complete SeqId Pagination Refactor
- **Status**: Completed.
- **Fixes**: Corrected `messageStore.ts` update issues ensuring `getMessageList` accepts `cursorSeqId`.

## [2026-01-08 13:45] Fix i18n Warnings for Missing Error Code Translations
- **Goal**: Fix console warnings "Not found 'api.errors.50001' key in 'ja' locale messages" and similar for other error codes
- **Changes**:
  - Added missing error code translations to all language files:
    - `40000`: "Bad request." / "请求参数错误。" / etc.
    - `40100`: "Unauthorized access. Please login again." / "未授权访问，请重新登录。" / etc.
    - `40300`: "Join is disabled or password login is not enabled." / "加入被禁用或密码登录未启用。" / etc.
    - `40400`: "Resource not found." / "资源未找到。" / etc.
    - `41001`: "User not found." / "用户未找到。" / etc.
    - `41002`: "User already exists." / "用户已存在。" / etc.
    - `41003`: "Invalid credentials." / "用户名或密码错误。" / etc.
    - `42001`: "Room not found or has been deleted." / "房间未找到或已被删除。" / etc.
    - `42002`: "No access permission: You are not a member of this chat room." / "无访问权限：您不是该聊天室的成员。" / etc.
    - `42003`: "Password is required." / "密码必填。" / etc.
    - `42004`: "Incorrect password." / "密码错误。" / etc.
    - `42010`: "Invalid invite code." / "邀请码无效。" / etc.
    - `42011`: "Invite code has expired." / "邀请码已过期。" / etc.
    - `42012`: "Invite code has been revoked." / "邀请码已被撤销。" / etc.
    - `42013`: "Invite code usage limit reached." / "邀请码使用次数已满。" / etc.
    - `43001`: "File is empty or not selected." / "文件为空或未选择。" / etc.
    - `43002`: "File is too large. Please choose a smaller one." / "文件过大，请选择较小的文件。" / etc.
    - `50000`: "System internal error. Please try again later." / "系统内部错误，请稍后重试。" / etc.
    - `50001`: "Database error. Please try again later." / "数据库错误，请稍后重试。" / etc.
    - `53001`: "File upload failed." / "文件上传失败。" / etc.
  - **Files Modified**:
    - `/home/dev/EZChat/frontend/vue-ezchat/src/i18n/locales/en.json`
    - `/home/dev/EZChat/frontend/vue-ezchat/src/i18n/locales/ja.json`
    - `/home/dev/EZChat/frontend/vue-ezchat/src/i18n/locales/zh.json`
    - `/home/dev/EZChat/frontend/vue-ezchat/src/i18n/locales/zh-tw.json`
    - `/home/dev/EZChat/frontend/vue-ezchat/src/i18n/locales/ko.json`
  - **Root Cause**: The `request.ts` file uses `t(`api.errors.${code}`)` to get error message translations. When a translation key is missing, vue-i18n shows warnings in the console even though the code falls back to using the backend error message.
  - **Verification**: After adding all missing error code translations, the warnings should disappear from the console.
## [2026-01-08 13:48] Fix GIF Avatar Animation
- **Goal**: Prioritize GIF original URL over static thumbnail in Avatar component.
- **Changes**:
  - `src/components/Avatar.vue`: Updated `watchEffect` to use regex `/\.gif($|\?)/i` check.
## [2026-01-08 13:50] Deprecate SmartAvatar
- **Goal**: Standardize avatar usage by using `Avatar.vue`.
- **Changes**:
  - Refactored `UserItem.vue` and `Join/index.vue` to use `Avatar`.
  - Deleted `src/components/SmartAvatar.vue`.

## [2026-01-08 15:25] Fix JoinChatDialog Height Inconsistency
- **Goal**: Resolve height jumping when switching to result step in JoinChatDialog.
- **Changes**:
  - `frontend/vue-ezchat/src/components/dialogs/JoinChatDialog.vue`:
    - Removed dynamic title text in result step (user request), simplified to `visibility: hidden` to preserve layout height.
    - Kept header DOM element to prevent layout collapse.
    - Kept `.join-dialog-content` fixed height for stability.
    - Adjusted Result Step layout: Increased top spacing (`padding-bottom` shift), widened message container to 100%, and increased gap between Title and Message.

## [2026-01-08 15:35] Optimize JoinChatDialog Height
- **Goal**: Compress dialog height and optimize vertical spacing for a more compact look.
- **Changes**:
  - `frontend/vue-ezchat/src/components/dialogs/JoinChatDialog.vue`:
    - Reduced dialog fixed height from 380px to 320px.
    - Reduced internal margins (Title, Mode Switcher, Form Items) to fit the compact height.
    - Reduced Input height from 48px to 44px.
    - Reduced Tab Switcher height from 36px to 32px.

## [2026-01-08 15:45] Verify Globalization in useJoinInput.ts
- **Goal**: Verify that validation error messages in useJoinInput.ts are fully internationalized
- **Findings**:
  - The validation error mapping in `useJoinInput.ts` (lines 268-274) correctly maps error codes to i18n keys:
    - `'ROOM_ID_REQUIRED'`: `'validation.chat_code_required'`
    - `'INVALID_ROOM_ID_FORMAT'`: `'validation.chat_code_format'`
    - `'PASSWORD_REQUIRED'`: `'validation.password_required'`
    - `'INVITE_URL_REQUIRED'`: `'validation.invite_url_required'`
    - `'INVALID_INVITE_URL_FORMAT'`: `'validation.invite_url_format'`
  - All i18n keys are properly defined in all language files (en.json, ja.json, zh.json, zh-tw.json, ko.json)
  - The `parseAndValidateJoinInfo` function in `validators.ts` throws Error objects with these error codes
  - The `validateAndGetPayload` function catches these errors and maps them to i18n messages using `t()` function
- **Status**: Globalization is already complete and working correctly
- **Files Verified**:
  - `frontend/vue-ezchat/src/hooks/chat/join/useJoinInput.ts`
  - `frontend/vue-ezchat/src/utils/validators.ts`
  - All language files in `frontend/vue-ezchat/src/i18n/locales/`
## [2026-01-08 17:45] Optimizing Light Mode Colors
- **Goal**: Deeply optimize Day Mode to match the premium quality of Dark Mode.
- **Changes**: 
  - Modified `src/assets/main.css`: Updated `:root` variables for a cooler `--bg-page`, blue-tinted `--shadow-glass`, and more translucent `--bg-glass`.
## [2026-01-08 17:50] Refined Light Mode Palette
- **Goal**: Address user feedback ("Input gray too deep") and improve overall harmony.
- **Changes**: 
  - Modified `src/assets/main.css`:
    - Updated `--bg-page` to `#f8fafc` (Slate 50) for a cleaner, brighter look.
    - Updated `--bg-input` to `#ffffff` (Pure White) for maximum contrast and cleanliness.

## [2026-01-08 18:25] Removing UserItem Animation
- **Goal**: Remove hover animation effects for a cleaner UI.
- **Changes**: 
  - Modified `components/UserItem.vue`: Removed `transition` and `transform` properties.

## [2026-01-08 18:27] Adding Settings Button to UserItem
- **Goal**: Remove hover bg effect and add a settings button for action access.
- **Changes**: 
  - Modified `components/UserItem.vue`:
    - Removed hover background color.
    - Added `Setting` icon and settings button.
    - Emits `setting` event on click.

## [2026-01-08 18:29] Refining UserItem Settings Button
- **Goal**: Align button style with AsideList for consistency.
- **Changes**: 
  - Modified `components/UserItem.vue`: Updated `.setting-btn` style (glass bg, 8px radius, primary hover).

## [2026-01-08 18:33] Improving UserItem Dark Mode Contrast
- **Goal**: Make settings button visible against dark card background.
- **Changes**: 
  - Modified `components/UserItem.vue`: Added `:global(html.dark)` styles for `.setting-btn`.

## [2026-01-08 18:35] Tuning MainAside Switcher Contrast
- **Goal**: Improve light mode awareness by darkening the segment container.
- **Changes**: 
  - Modified `views/layout/layout/MainAside.vue`: Changed `.segmented-control` bg to `var(--el-fill-color)` (grayish) instead of blank (white).

## [2026-01-08 18:36] Fix MainAside Switcher Dark Mode
- **Goal**: Resolve "ugly" appearance in dark mode after light mode fix.
- **Changes**: 
  - Modified `views/layout/layout/MainAside.vue`: Added `:global(html.dark)` override for `.segmented-control` to use dark translucent background.

## [2026-01-08 18:40] Fixing Switcher Padding Symmetry
- **Goal**: Ensure the slider is perfectly centered with equal gaps.
- **Changes**: 
  - Modified `views/layout/layout/MainAside.vue`: Adjusted padding to 2px and recalculated transforms.

## [2026-01-08 18:43] Enforcing Switcher Strict Width
- **Goal**: Prevent text length from affecting item widths.
- **Changes**: 
  - Modified `views/layout/layout/MainAside.vue`: Included `flex: 1 1 0px` and `width: 0` for strict equal width. Reset padding to 2px.

## [2026-01-08 18:46] Implementing Flush Switcher
- **Goal**: Remove gap around the slider for a seamless look.
- **Changes**: 
  - Modified `views/layout/layout/MainAside.vue`: 
    - Updated `.selection-indicator` to use `top: 0`, `left: 0`, `width: 50%`, `height: 100%`.
    - Corrected transform to `translateX(100%)`.

## [2026-01-08 19:05] Update Chat List on ACK
- **Goal**: Ensure room list updates (last message/time) when message is ACKed.
- **Changes**: 
  - Modified `stores/messageStore.ts`: Called `roomStore.updateRoomPreview(msg)` inside `handleAck`.

## [2026-01-08 19:10] Update Chat List on Sync Fallback
- **Goal**: Ensure room list updates even if ACK fails but Sync succeeds.
- **Changes**: 
  - Modified `stores/messageStore.ts`: Added `roomStore.updateRoomPreview(msg)` to the sync success block in `sendMessage` timeout.

## [2026-01-08 19:20] Verify Message Pagination Refactor to SeqId
- **Goal**: Verify that message pagination has been successfully refactored from timestamp-based to seqId-based as per `.prompt.md` plan
- **Findings**: The refactoring is already complete and working correctly:
  
  ### Backend Changes (Already Implemented):
  1. **MessageMapper** (`MessageMapper.java` & `MessageMapper.xml`):
     - Method renamed: `selectMessageListByChatIdAndTimeStamp` → `selectMessageListByChatIdAndCursor`
     - Parameter changed: `timeStamp` → `cursorSeqId`
     - SQL query: `WHERE chat_id = #{chatId}` + `AND m.seq_id < #{cursorSeqId}` (if cursorSeqId not null)
     - Order by: `ORDER BY m.seq_id DESC LIMIT 30`
  
  2. **MessageService** (`MessageService.java` & `MessageServiceImpl.java`):
     - Updated `getMessagesByChatCode` signature: `(Integer userId, String chatCode, Long cursorSeqId)`
     - Passes `cursorSeqId` to mapper: `messageMapper.selectMessageListByChatIdAndCursor(chatId, cursorSeqId)`
  
  3. **MessageController** (`MessageController.java`):
     - Updated endpoint: `@RequestParam(required = false) Long cursorSeqId` (was `createTime`)
     - URL: `/message?chatCode=ABC&cursorSeqId=100`

  ### Frontend Changes (Already Implemented):
  1. **Message.ts** (`src/api/Message.ts`):
     - Updated `GetMessageListApiReq` type: `cursorSeqId?: number` (was `createTime`)
     - Updated `getMessageListApi` to construct URL with `cursorSeqId` parameter
  
  2. **messageStore.ts** (`src/stores/messageStore.ts`):
     - Updated `getMessageList` to accept `cursorSeqId` (number) parameter
     - In `loadMoreHistory` function: passes `oldestMessage?.seqId` as cursor
     - Properly handles pagination: `cursorSeqId` = null for latest messages, `cursorSeqId` = oldest message's seqId for loading more

- **Status**: Refactoring is complete and fully functional
- **Benefits**:
  - More reliable pagination using sequence IDs instead of timestamps
  - Better alignment with sequence-based architecture
  - Eliminates issues with duplicate timestamps or clock skew
  - Provides stable cursor for infinite scrolling

## [2026-01-08 19:45] Complete Globalization of GuestAside.vue
- **Goal**: Internationalize all hardcoded text in GuestAside.vue component
- **Changes**:

  ### Added New i18n Keys to All Language Files:
  Added `upgrade` section with the following keys to all 5 language files (en.json, ja.json, zh.json, zh-tw.json, ko.json):
  - `upgrade.benefits.create_chat`: "创建专属聊天频道" / "Create exclusive chat channels" / etc.
  - `upgrade.benefits.unlimited_join`: "聊天室加入无限制" / "Unlimited chat room access" / etc.
  - `upgrade.benefits.cloud_storage`: "消息云端永久保存" / "Permanent cloud message storage" / etc.
  - `upgrade.benefits.multi_device`: "多端实时同步" / "Real-time multi-device sync" / etc.
  - `upgrade.benefits.custom_profile`: "头像昵称自定义" / "Custom avatar and nickname" / etc.
  - `upgrade.title`: "解锁完整功能体验" / "Unlock full feature experience" / etc.
  - `upgrade.button`: "成为正式用户" / "Become a formal user" / etc.
  - `upgrade.dialog_title`: "升级正式账号" / "Upgrade to formal account" / etc.
  - `upgrade.dialog_subtitle`: "解锁完整功能体验" / "Unlock full feature experience" / etc.
  - `upgrade.nickname_placeholder`: "设置昵称" / "Set nickname" / etc.
  - `upgrade.bio_placeholder`: "一句话介绍自己..." / "Introduce yourself in one sentence..." / etc.
  - `upgrade.username_placeholder`: "设置登录账号" / "Set login account" / etc.
  - `upgrade.password_placeholder`: "设置登录密码（8-20位）" / "Set login password (8-20 characters)" / etc.
  - `upgrade.confirm_password_placeholder`: "再次输入密码" / "Re-enter password" / etc.
  - `upgrade.cancel_button`: "取消" / "Cancel" / etc.
  - `upgrade.submit_button`: "立即升级" / "Upgrade now" / etc.
  - `upgrade.avatar_tip`: "支持 JPG/PNG，小于 2MB" / "Supports JPG/PNG, less than 2MB" / etc.
  - `upgrade.success`: "升级成功，欢迎成为正式用户！" / "Upgrade successful, welcome as a formal user!" / etc.
  - `upgrade.failed`: "升级失败" / "Upgrade failed" / etc.
  - `upgrade.avatar_upload_success`: "头像上传成功" / "Avatar uploaded successfully" / etc.
  - `upgrade.avatar_upload_failed`: "头像上传失败" / "Avatar upload failed" / etc.
  - `upgrade.avatar_format_error`: "头像图片必须是 JPG 或 PNG 格式！" / "Avatar picture must be JPG or PNG format!" / etc.
  - `upgrade.avatar_size_error`: "头像图片大小不能超过 2MB！" / "Avatar picture size can not exceed 2MB!" / etc.

  ### Updated GuestAside.vue:
  1. **Benefits Array**: Converted to computed property for reactivity with language changes
  2. **Form Validation Messages**: Updated to use existing `validation.*` keys
  3. **Success/Error Messages**: Updated to use new `upgrade.*` keys
  4. **UI Text**: Updated all placeholder texts, button labels, titles, and tooltips
  5. **Template Bindings**: Updated all hardcoded text to use `t()` function

  ### Files Modified:
  - `frontend/vue-ezchat/src/i18n/locales/en.json`
  - `frontend/vue-ezchat/src/i18n/locales/ja.json`
  - `frontend/vue-ezchat/src/i18n/locales/zh.json`
  - `frontend/vue-ezchat/src/i18n/locales/zh-tw.json`
  - `frontend/vue-ezchat/src/i18n/locales/ko.json`
  - `frontend/vue-ezchat/src/views/layout/components/GuestAside.vue`

- **Verification**: All hardcoded text in GuestAside.vue is now fully internationalized and will automatically switch languages when the user changes language preference.
## [2026-01-09 07:31] Dual Token + Guest Cleanup
- **Goal**: 实现 access/refresh 双 Token、Caffeine 缓存、刷新接口、WS 刷新重连与访客离线清理
- **Changes**: backend/EZChat-app/pom.xml, backend/EZChat-app/src/main/java/hal/th50743/config/TokenCacheConfig.java, backend/EZChat-app/src/main/java/hal/th50743/service/TokenCacheService.java, backend/EZChat-app/src/main/java/hal/th50743/service/impl/TokenCacheServiceImpl.java, backend/EZChat-app/src/main/java/hal/th50743/pojo/LoginVO.java, backend/EZChat-app/src/main/java/hal/th50743/assembler/LoginAssembler.java, backend/EZChat-app/src/main/java/hal/th50743/pojo/FormalUser.java, backend/EZChat-app/src/main/java/hal/th50743/pojo/User.java, backend/EZChat-app/src/main/java/hal/th50743/mapper/UserMapper.java, backend/EZChat-app/src/main/resources/hal/th50743/mapper/UserMapper.xml, backend/EZChat-app/src/main/resources/hal/th50743/mapper/ChatMemberMapper.xml, backend/EZChat-app/src/main/java/hal/th50743/service/UserService.java, backend/EZChat-app/src/main/java/hal/th50743/service/impl/UserServiceImpl.java, backend/EZChat-app/src/main/java/hal/th50743/service/FormalUserService.java, backend/EZChat-app/src/main/java/hal/th50743/service/impl/FormalUserServiceImpl.java, backend/EZChat-app/src/main/java/hal/th50743/service/AuthService.java, backend/EZChat-app/src/main/java/hal/th50743/pojo/RefreshTokenReq.java, backend/EZChat-app/src/main/java/hal/th50743/service/PresenceService.java, backend/EZChat-app/src/main/java/hal/th50743/service/impl/PresenceServiceImpl.java, backend/EZChat-app/src/main/java/hal/th50743/service/impl/AuthServiceImpl.java, backend/EZChat-app/src/main/java/hal/th50743/controller/AuthController.java, backend/EZChat-app/src/main/java/hal/th50743/interceptor/TokenInterceptor.java, backend/EZChat-app/src/main/java/hal/th50743/ws/WebSocketServer.java, backend/EZChat-app/src/main/java/hal/th50743/service/impl/GuestCleanupService.java, backend/EZChat-app/src/main/resources/sql/init.sql, frontend/vue-ezchat/src/type/index.ts, frontend/vue-ezchat/src/utils/validators.ts, frontend/vue-ezchat/src/api/Auth.ts, frontend/vue-ezchat/src/stores/userStore.ts, frontend/vue-ezchat/src/utils/request.ts, frontend/vue-ezchat/src/WS/useWebsocket.ts, frontend/vue-ezchat/src/stores/websocketStore.ts
## [2026-01-09 07:33] Update Formal User Type on Login
- **Goal**: 兼容已有正式用户数据，确保登录后 user_type 被设置为正式用户
- **Changes**: backend/EZChat-app/src/main/java/hal/th50743/service/impl/AuthServiceImpl.java
## [2026-01-09 08:41] 优化首页卡片翻转动画
- **Goal**: 提升 Guest/Login 卡片翻转和切换的流畅度。
- **Changes**: 
  - Modified `src/views/index/index.vue`: 
    - 动画时长 0.8s 缩短至 0.6s。
    - 翻转触发延迟从 600ms 缩短至 250ms，使响应
    - 优化 transitions 属性，添加 `will-change: transform` 提升性能。
  - Modified `src/views/index/components/LeftCard.vue` & `RightCard.vue`:
    - 同 0.6s。
    - 调整表单重置延迟为 600ms 以匹配动画时长。
    - 添加 `will-change: transform`。
## [2026-01-09 08:46] 调整卡片微小动画参数
- **Goal**: 微调动画时长以达到更舒适的节奏。
- **Changes**: 
  - Modified `src/views/index/index.vue`: 
    - 动画时长调整为 0.7s。
    - 翻转逻辑延迟调整为 500ms（配合 0.7s 动画的 70% 进度）。
  - Modified cards components: 
    - 同步 CSS transition 为 0.7s。
    - 同步内部状态重置逻辑延迟为 500ms。
  - **Results**:  0.8s 稍快，但比 0.6s 更稳重，且没有闪烁 glitch。
## [2026-01-09 10:14] 401 刷新锁与重试策略
- **Goal**: 区分 token 过期与其他 401，使用 refreshPromise 锁并限制重试。
- **Changes**:
  - Modified `frontend/vue-ezchat/src/utils/request.ts`:
    - 仅在 code=TOKEN_EXPIRED 时触发刷新，新增锁与请求等待逻辑。
    - 只自动重试 GET/HEAD，非幂等请求提示用户重试。
  - Modified `frontend/vue-ezchat/src/i18n/locales/zh.json`: 新增 api.retry_required 文案。
  - Modified `frontend/vue-ezchat/src/i18n/locales/zh-tw.json`: 新增 api.retry_required 文案。
  - Modified `frontend/vue-ezchat/src/i18n/locales/en.json`: 新增 api.retry_required 文案。
  - Modified `frontend/vue-ezchat/src/i18n/locales/ja.json`: 新增 api.retry_required 文案。
  - Modified `frontend/vue-ezchat/src/i18n/locales/ko.json`: 新增 api.retry_required 文案。
## [2026-01-09 10:15] 调整刷新等待失败处理
- **Goal**: 刷新失败时避免误报网络错误，并清理未使用引用。
- **Changes**:
  - Modified `frontend/vue-ezchat/src/utils/request.ts`:
    - 刷新等待失败改为抛出 Session expired 标记错误。
    - 移除未使用的 userStore 变量。
## [2026-01-09 10:30] 401 过期码区分与刷新触发
- **Goal**: 后端明确返回 Token 过期错误码，前端仅在该码触发 refresh。
- **Changes**:
  - Modified `backend/EZChat-app/src/main/java/hal/th50743/exception/ErrorCode.java`: 新增 TOKEN_EXPIRED(40101)。
  - Modified `backend/EZChat-app/src/main/java/hal/th50743/interceptor/TokenInterceptor.java`: 未授权统一返回 JSON，过期返回 TOKEN_EXPIRED。
  - Modified `frontend/vue-ezchat/src/error/ErrorCode.ts`: 新增 TOKEN_EXPIRED。
  - Modified `frontend/vue-ezchat/src/utils/request.ts`: 仅对 40101 触发 refresh。
  - Modified `frontend/vue-ezchat/src/i18n/locales/zh.json`: 新增 api.errors.40101 文案。
  - Modified `frontend/vue-ezchat/src/i18n/locales/zh-tw.json`: 新增 api.errors.40101 文案。
  - Modified `frontend/vue-ezchat/src/i18n/locales/en.json`: 新增 api.errors.40101 文案。
  - Modified `frontend/vue-ezchat/src/i18n/locales/ja.json`: 新增 api.errors.40101 文案。
  - Modified `frontend/vue-ezchat/src/i18n/locales/ko.json`: 新增 api.errors.40101 文案。
## [2026-01-09 10:47] 修复刷新接口返回类型
- **Goal**: 让 refreshTokenApi 返回业务 Result，避免刷新被误判失败。
- **Changes**:
  - Modified `frontend/vue-ezchat/src/api/Auth.ts`: refreshTokenApi 改为返回 response.data。
## [2026-01-09 11:11] 拦截器拆分与验证工具迁移
- **Goal**: 拆分 request 拦截器逻辑并将通用校验方法移入 validators。
- **Changes**:
  - Added `frontend/vue-ezchat/src/utils/request/index.ts`: 统一创建 axios 实例并挂载拦截器。
  - Added `frontend/vue-ezchat/src/utils/request/types.ts`: 请求拦截器相关类型定义。
  - Added `frontend/vue-ezchat/src/utils/request/utils.ts`: 请求工具函数（需要 token/限流/方法判断）。
  - Added `frontend/vue-ezchat/src/utils/request/refresh.ts`: refreshPromise 锁与 401 处理。
  - Added `frontend/vue-ezchat/src/utils/request/interceptors/request/auth.ts`: token 注入与刷新等待。
  - Added `frontend/vue-ezchat/src/utils/request/interceptors/request/rateLimit.ts`: 前端限流逻辑。
  - Added `frontend/vue-ezchat/src/utils/request/interceptors/response/business.ts`: 业务错误处理。
  - Added `frontend/vue-ezchat/src/utils/request/interceptors/response/http.ts`: HTTP 错误处理。
  - Modified `frontend/vue-ezchat/src/utils/request.ts`: 改为导出新 request 实例。
  - Modified `frontend/vue-ezchat/src/utils/validators.ts`: 新增 isRecord 与 extractErrorCode。
## [2026-01-09 11:16] 合并请求类型至全局类\
- **Goal**: 将 RetryableRequestConfig 和 ErrorCodeValue 迁移至 src/type/index.ts，集中管理类型并简化引用。
- **Changes**: 修改了 [index.ts](file:///home/dev/EZChat/frontend/vue-ezchat/src/type/index.ts)、[refresh.ts](file:///home/dev/EZChat/frontend/vue-ezchat/src/utils/request/refresh.ts) 等 5 个文件，删除了冗余的 [types.ts](file:///home/dev/EZChat/frontend/vue-ezchat/src/utils/request/types.ts)。
## [2026-01-09 11:17] 删除旧版 request.ts 转发文件
- **Goal**: 清理冗余代码。逻辑已完全迁移至 src/utils/request/ 目录。
- **Changes**: 删除了 [request.ts](file:///home/dev/EZChat/frontend/vue-ezchat/src/utils/request.ts)。
## [2026-01-09 11:43] WS 连接前刷新 Token
- **Goal**: Safari 建连前确保 accessToken 未过期，避免 WS 握手被拒绝。
- **Changes**:
  - Modified `frontend/vue-ezchat/src/utils/validators.ts`: 新增 decodeJwtPayload 与 isTokenExpired。
  - Modified `frontend/vue-ezchat/src/stores/websocketStore.ts`: initWS 建连前校验并刷新 token。
## [2026-01-09 12:03] WS Token 迁移为 Query 参数
- **Goal**: 将 WebSocket 鉴权 token 从路径迁移到查询参数。
- **Changes**:
  - Modified `backend/EZChat-app/src/main/java/hal/th50743/ws/WebSocketServer.java`: 端点改为 `/websocket`，从查询参数解析 token。
  - Modified `frontend/vue-ezchat/src/stores/websocketStore.ts`: WS URL 使用 `?token=` 形式。
- **Tests**:
  - `npm run type-check` (failed: `src/components/notification.ts` 类型错误与本次修改无关)

## [2026-01-09 12:27] Analyze Vite WS Proxy Relevance
- **Goal**: 判断 Safari WebSocket 问题是否与 Vite 代理有关并给出方向
- **Changes**: 未修改代码；给出 Vite/Nginx 侧排查建议

## [2026-01-09 12:29] Diagnose Safari WS First-Login Failure
- **Goal**: 分析 Safari 刚登录时 WS 无法连接的潜在原因并给出排查方向
- **Changes**: 未修改代码；提供竞态与时序问题的排查建议
## [2026-01-09 13:05] Chat Room Leave/Disband
- **Goal**: Add leave-room, owner transfer on leave, and disband-room flows with WS broadcasts and UI actions.
- **Changes**: backend ChatService/Controller/mapper updates, new broadcast VO classes; frontend ChatHeader menu + composable, websocket handlers, room store updates, i18n strings, system message handling.
## [2026-01-09 14:00] Room Settings Invite Management
- **Goal**: Add owner-only room settings with invite link management and backend APIs.
- **Changes**:
  - `backend/EZChat-app/src/main/resources/sql/init.sql`: Added invite_code column.
  - `backend/EZChat-app/src/main/java/hal/th50743/pojo/ChatInvite.java`: Added inviteCode field/docs.
  - `backend/EZChat-app/src/main/java/hal/th50743/pojo/ChatInviteCreateReq.java`: New request.
  - `backend/EZChat-app/src/main/java/hal/th50743/pojo/ChatInviteVO.java`: New VO.
  - `backend/EZChat-app/src/main/java/hal/th50743/service/ChatInviteService.java`: New service interface.
  - `backend/EZChat-app/src/main/java/hal/th50743/service/impl/ChatInviteServiceImpl.java`: Invite management logic.
  - `backend/EZChat-app/src/main/java/hal/th50743/mapper/ChatInviteMapper.java` and `backend/EZChat-app/src/main/resources/hal/th50743/mapper/ChatInviteMapper.xml`: Added invite_code and list/count/revoke queries.
  - `backend/EZChat-app/src/main/java/hal/th50743/controller/ChatController.java`: Added invite endpoints.
  - `backend/EZChat-app/src/main/java/hal/th50743/service/impl/ChatServiceImpl.java`: Reused invite service in create.
  - `frontend/vue-ezchat/src/views/chat/layout/ChatHeader.vue`: Owner-only menu item + dialog mount.
  - `frontend/vue-ezchat/src/components/dialogs/RoomSettingsDialog.vue`: New dialog UI.
  - `frontend/vue-ezchat/src/composables/useRoomInviteManager.ts`: Invite management composable.
  - `frontend/vue-ezchat/src/api/Chat.ts`: Invite APIs.
  - `frontend/vue-ezchat/src/type/index.ts`: Added ChatInvite types.
  - `frontend/vue-ezchat/src/utils/validators.ts`: Added invite type guards.
  - `frontend/vue-ezchat/src/stores/roomStore.ts`: Added roomSettingsDialogVisible.
  - `frontend/vue-ezchat/src/composables/useChatRoomActions.ts`: Exposed isOwner.
  - `frontend/vue-ezchat/src/i18n/locales/en.json`: Added room_settings strings.
  - `frontend/vue-ezchat/src/i18n/locales/ja.json`: Added room_settings strings.
  - `frontend/vue-ezchat/src/i18n/locales/ko.json`: Added room_settings strings.
  - `frontend/vue-ezchat/src/i18n/locales/zh-tw.json`: Added room_settings strings.
  - `frontend/vue-ezchat/src/i18n/locales/zh.json`: Added room_settings strings.
## [2026-01-09 14:07] Fix MyBatis XML Parse Error
- **Goal**: Resolve ChatInviteMapper.xml parsing failure by escaping '<'.
- **Changes**: `backend/EZChat-app/src/main/resources/hal/th50743/mapper/ChatInviteMapper.xml`

## [2026-01-09 14:18] Fix string syntax in RoomSettingsDialog
- **Goal**: Fix multiline string syntax error causing TS error.
- **Changes**: frontend/vue-ezchat/src/components/dialogs/RoomSettingsDialog.vue
## [2026-01-09 14:23] Fix RoomSettingsDialog z-index
- **Goal**: Fix dialog obscuring issue
- **Changes**: RoomSettingsDialog.vue (added append-to-body)
## [2026-01-09 14:33] Add Room Password Settings
- **Goal**: Add room password enable/disable UI in RoomSettings dialog with backend update API.
- **Changes**:
  - `backend/EZChat-app/src/main/java/hal/th50743/pojo/ChatPasswordUpdateReq.java`: New request object.
  - `backend/EZChat-app/src/main/java/hal/th50743/mapper/ChatMapper.java` and `backend/EZChat-app/src/main/resources/hal/th50743/mapper/ChatMapper.xml`: Add updateChatPassword.
  - `backend/EZChat-app/src/main/java/hal/th50743/service/ChatService.java`: New updateChatPassword signature.
  - `backend/EZChat-app/src/main/java/hal/th50743/service/impl/ChatServiceImpl.java`: Implement password update logic.
  - `backend/EZChat-app/src/main/java/hal/th50743/controller/ChatController.java`: Add /chat/{chatCode}/password endpoint.
  - `frontend/vue-ezchat/src/api/Chat.ts`: Add updateChatPasswordApi.
  - `frontend/vue-ezchat/src/type/index.ts`: Add ChatPasswordUpdateReq type.
  - `frontend/vue-ezchat/src/composables/useRoomPasswordSettings.ts`: New composable for password form + validation.
  - `frontend/vue-ezchat/src/components/dialogs/settings/RoomPasswordSettings.vue`: New password settings section.
  - `frontend/vue-ezchat/src/components/dialogs/RoomSettingsDialog.vue`: Render password settings in list step.
  - `frontend/vue-ezchat/src/i18n/locales/en.json`: Add room_settings password/create invite keys.
  - `frontend/vue-ezchat/src/i18n/locales/ja.json`: Add room_settings password/create invite keys.
  - `frontend/vue-ezchat/src/i18n/locales/ko.json`: Add room_settings password/create invite keys.
  - `frontend/vue-ezchat/src/i18n/locales/zh-tw.json`: Add room_settings password/create invite keys.
  - `frontend/vue-ezchat/src/i18n/locales/zh.json`: Add room_settings password/create invite keys.

## [2026-01-09 14:38] Refactor RoomSettingsDialog to Sidebar Layout
- **Goal**: Implement a sidebar layout for Room Settings.
- **Changes**: Refactored RoomSettingsDialog.vue to use flex container with Left Sidebar and Right Content.

## [2026-01-09 14:41] Fix RoomSettingsDialog Dimensions
- **Changes**: Updated dialog width to 800px and body height to 550px.

## [2026-01-09 14:43] Update RoomSettingsDialog Dimensions Again
- **Changes**: Updated dialog width to 900px and body height to 650px.

## [2026-01-09 14:44] Fix RoomSettingsDialog Corruption
- **Changes**: Restore file and set dimensions to 900px width and 650px height.

## [2026-01-09 14:45] Fix RoomInviteCreate Footer
- **Changes**: Updated CSS to fix footer buttons to the bottom using flex-grow and margin-top: auto.

## [2026-01-09 14:46] Fix Syntax Error in RoomInviteCreate
- **Changes**: Restored missing <style scoped> tag.

## [2026-01-09 14:48] I18n Complete
- **Changes**: Added missing keys to zh.json/en.json and removed hardcoded fallbacks in RoomSettingsDialog.vue.

## [2026-01-09 14:52] I18n Fixes
- **Goal**: Complete i18n for all languages and fix title key.
- **Changes**: 
  - Updated ja.json, ko.json, zh-tw.json.
  - Fixed RoomSettingsDialog.vue to use valid key 'chat.room_info'.

## [2026-01-09 14:55] I18n Update
- **Changes**: Renamed 'Security Settings' to 'Password Settings' in all locale files.

## [2026-01-09 14:58] CSS Cleanup
- **Goal**: Optimize sidebar menu text colors and remove hardcoding.
- **Changes**: Replaced invalid vars with --primary, --text-*, --el-fill-color-light. Fixed Dark Mode active state.

## [2026-01-09 15:00] Dark Mode Sidebar
- **Changes**: Added rounded corners (left: 8px) and optimized background for dark mode.

## [2026-01-09 15:01] Dark Mode Divider
- **Changes**: Removed border-right from sidebar in dark mode.

## [2026-01-09 15:05] Dark Mode Invert
- **Changes**: Inverted contrast. Sidebar is now transparent (lighter), content has dark overlay.

## [2026-01-09 15:08] Dark Mode Rounding
- **Changes**: Added border-radius (8px) and margin (4px) to dialog-content in dark mode.

## [2026-01-09 15:10] Light Mode Divider
- **Changes**: Removed light mode border. Sidebar is now var(--bg-page) (Gray), Content is var(--bg-card) (White).

## [2026-01-09 15:15] Sidebar Rounding
- **Changes**: Applied all-around border-radius (8px) and margin (4px) to sidebar.

## [2026-01-09 15:18] I18n Japanese Update
- **Changes**: Renamed '招待管理' to '招待リンク管理' in ja.json.

## [2026-01-09 15:21] Button Resize
- **Changes**: Resized 'New' button to 'large' (44px height).

## [2026-01-09 15:23] Button Resize Match
- **Changes**: Removed size='large' from 'New' button to match 'Save Password' button height.
## [2026-01-09 15:16] Refresh Token Before 401 on App Refresh
- **Goal**: Attempt access token refresh once during refresh initialization before showing 401.
- **Changes**:
  - `frontend/vue-ezchat/src/composables/useAppRefreshToken.ts`: Return token + hadToken, simplify refresh flow.
  - `frontend/vue-ezchat/src/stores/appStore.ts`: Pre-refresh accessToken and logout with dialog only if refresh fails.

## [2026-01-09 15:25] GIF Avatar Support
- **Changes**: Updated ChatItem.vue to use original URL for GIF avatars to support animation.

## [2026-01-09 15:33] Avatar Image Prop Refactor
- **Goal**: Switch Avatar to accept Image objects and update all usages to pass Image data consistently.
- **Changes**:
  - `frontend/vue-ezchat/src/components/dialogs/CreateChatDialog.vue`: Build display avatar Image with default fallback and pass via :image.
  - `frontend/vue-ezchat/src/components/UserItem.vue`: Convert string avatar to Image and pass via :image.
  - `frontend/vue-ezchat/src/views/layout/components/UserItem.vue`: Convert string avatar to Image and pass via :image.
  - `frontend/vue-ezchat/src/views/layout/components/ChatItem.vue`: Remove thumb logic and pass chat.avatar via :image.
  - `frontend/vue-ezchat/src/views/layout/components/GuestAside.vue`: Pass form.avatar via :image.
  - `frontend/vue-ezchat/src/views/chat/layout/ChatHeader.vue`: Pass currentRoom.avatar via :image.
  - `frontend/vue-ezchat/src/views/chat/components/MessageItem.vue`: Pass sender avatar via :image.
  - `frontend/vue-ezchat/src/views/chat/components/ChatMemberItem.vue`: Pass member.avatar via :image.
  - `frontend/vue-ezchat/src/views/Join/index.vue`: Build guest avatar Image with default fallback and pass via :image.

## [2026-01-09 15:49] Refresh Flow Token Lock
- **Goal**: Ensure /chat refresh waits for proactive refresh and uses new accessToken before user info requests.
- **Changes**:
  - `frontend/vue-ezchat/src/stores/userStore.ts`: Add loadUserInfo option for restore/sync, expose refresh promise, add syncLoginUserInfo helper.
  - `frontend/vue-ezchat/src/composables/useAppRefreshToken.ts`: Skip user info load during proactive refresh restore.
  - `frontend/vue-ezchat/src/router/index.ts`: Skip user info load before refresh on /chat entry.
  - `frontend/vue-ezchat/src/stores/appStore.ts`: Trigger user info sync after refresh before room list load.
  - `frontend/vue-ezchat/src/utils/request/refresh.ts`: Use userStore refresh promise as global lock.

## [2026-01-09 15:57] Login Error Feedback
- **Goal**: Ensure login API business errors (e.g. invalid credentials) show ElMessage on the home page.
- **Changes**:
  - `frontend/vue-ezchat/src/hooks/useCooldown.ts`: Make tryExecute async-aware and return execution flag.
  - `frontend/vue-ezchat/src/hooks/useLogin.ts`: Await tryExecute, handle errors centrally, and always clear loading state.

## [2026-01-09 16:42] Room Settings i18n Completion
- **Goal**: Complete missing locale strings for room settings and member removal alerts.
- **Changes**:
  - `frontend/vue-ezchat/src/i18n/locales/ko.json`: Add room settings tabs/labels, member removal messaging, and error 42005.
  - `frontend/vue-ezchat/src/i18n/locales/zh-tw.json`: Add validation, room settings labels, member removal messaging, and error 42005.

## [2026-01-09 16:51] Room Basic Settings Echo
- **Goal**: Ensure room basic settings form echoes current room data on dialog open.
- **Changes**:
  - `frontend/vue-ezchat/src/composables/useRoomBasicSettings.ts`: Make dialog open sync immediate for default avatar and form fields.

## [2026-01-09 17:04] Room Member Row Actions
- **Goal**: Add per-member transfer/removal actions and remove the bottom transfer section while keeping batch remove.
- **Changes**:
  - `frontend/vue-ezchat/src/composables/useRoomMemberManagement.ts`: Add per-row transfer/kick actions.
  - `frontend/vue-ezchat/src/components/dialogs/settings/RoomMemberManagement.vue`: Render per-row action buttons and remove transfer section.

## [2026-01-09 17:21] Rename Hooks to Composables
- **Goal**: Unify hook utilities under the composables naming convention.
- **Changes**:
  - `frontend/vue-ezchat/src/hooks/*`: Moved into `frontend/vue-ezchat/src/composables/`.
  - Import paths updated from `@/hooks/...` to `@/composables/...`.

## [2026-01-09 17:28] Room Password Fake Echo
- **Goal**: Keep password settings form filled and fake-echo values on dialog reopen.
- **Changes**:
  - `frontend/vue-ezchat/src/composables/useRoomPasswordSettings.ts`: Cache per-room password settings and sync on open; keep form values after save.

## [2026-01-09 17:37] Chat Password Enabled Flag
- **Goal**: Expose room password status to the frontend for accurate switch state.
- **Changes**:
  - `backend/EZChat-app/src/main/java/hal/th50743/pojo/ChatVO.java`: Add passwordEnabled field.
  - `backend/EZChat-app/src/main/resources/hal/th50743/mapper/ChatMapper.xml`: Select password_enabled based on chat_password_hash.
  - `backend/EZChat-app/src/main/java/hal/th50743/assembler/ChatAssembler.java`: Sanitize passwordEnabled for public responses.
  - `frontend/vue-ezchat/src/type/index.ts`: Add passwordEnabled to ChatRoom type.
  - `frontend/vue-ezchat/src/composables/useRoomPasswordSettings.ts`: Initialize switch from currentRoom.passwordEnabled.

## [2026-01-09 17:46] Room Password UI Redesign
- **Goal**: Make password settings switch-driven with explicit edit flow and hide inputs after save.
- **Changes**:
  - `frontend/vue-ezchat/src/composables/useRoomPasswordSettings.ts`: Add edit state, toggle handling, and save flow adjustments.
  - `frontend/vue-ezchat/src/components/dialogs/settings/RoomPasswordSettings.vue`: Redesign UI with switch row, change button, and conditional inputs.
  - `frontend/vue-ezchat/src/i18n/locales/zh.json`: Add password change label.
  - `frontend/vue-ezchat/src/i18n/locales/en.json`: Add password change label.
  - `frontend/vue-ezchat/src/i18n/locales/ja.json`: Add password change label.
  - `frontend/vue-ezchat/src/i18n/locales/ko.json`: Add password change label.
  - `frontend/vue-ezchat/src/i18n/locales/zh-tw.json`: Add password change label.

## [2026-01-09 18:09] Remove AccessToken Persistence
- **Goal**: Stop persisting accessToken in localStorage while keeping refreshToken-based restore.
- **Changes**:
  - `frontend/vue-ezchat/src/stores/userStore.ts`: Sanitize stored login payloads to remove accessToken and update restore/refresh flows.
  - `frontend/vue-ezchat/src/composables/useGuest.ts`: Persist guest login without accessToken.

## [2026-01-09 17:10] Member List Style
- **Changes**: Removed border and background from member list in RoomMemberManagement.vue.

## [2026-01-09 17:15] Syntax Fix
- **Changes**: Fixed missing closing brace in RoomMemberManagement.vue CSS.

## [2026-01-09 17:18] Member Actions Alignment
- **Changes**: Forced full width on checkbox label to align buttons to the right.

## [2026-01-09 17:21] Member List Typography
- **Changes**: Matched ChatMemberItem styles (Avatar 40px, UID badge, Fonts).

## [2026-01-09 17:28] List Height Optimization
- **Changes**: Configured member list and invite list to fill available vertical space.

## [2026-01-09 17:31] Zebra Striping
- **Changes**: Added alternating background colors to member list.

## [2026-01-09 17:52] Password UI Polish
- **Changes**: Enhanced input and button styles in RoomPasswordSettings.vue.

## [2026-01-09 17:55] Revert UI Changes
- **Changes**: Reverted visual styles in RoomPasswordSettings.vue to previous version.

## [2026-01-09 17:58] Fix Style Loss
- **Changes**: Restored CSS styles that were accidentally deleted during revert.

## [2026-01-09 17:58] Refine Room Settings UI
- **Goal**: Update "Change Password" button style to match "Save" button.
- **Changes**: frontend/vue-ezchat/src/components/dialogs/settings/RoomPasswordSettings.vue

## [2026-01-09 17:59] Refine Room Settings UI
- **Goal**: Reorder and right-align Save/Cancel buttons.
- **Changes**: frontend/vue-ezchat/src/components/dialogs/settings/RoomPasswordSettings.vue

## [2026-01-09 18:03] Update Documentation
- **Goal**: Sync README with recent architectural changes (Dual Token, SeqId, Audit Logs).
- **Changes**: README.md (Updated Features, Schema, API examples, Changelog).

## [2026-01-09 18:05] Update Documentation (Missing Features)
- **Goal**: Add missing items (Security, Composables, Room Settings) to Changelog.
- **Changes**: README.md

## [2026-01-09 18:32] RefreshToken Storage Only
- **Goal**: Persist only refreshToken in localStorage and rebuild login state from it.
- **Changes**: frontend/vue-ezchat/src/stores/userStore.ts; frontend/vue-ezchat/src/utils/request/interceptors/request/auth.ts; frontend/vue-ezchat/src/utils/request/interceptors/request/rateLimit.ts; frontend/vue-ezchat/src/composables/useGuest.ts

## [2026-01-09 18:56] Force Logout On Duplicate Login
- **Goal**: Enforce single-session login by forcing online users to logout on new login.
- **Changes**: backend/EZChat-app/src/main/java/hal/th50743/service/impl/AuthServiceImpl.java; backend/EZChat-app/src/main/java/hal/th50743/service/FormalUserService.java; backend/EZChat-app/src/main/java/hal/th50743/service/impl/FormalUserServiceImpl.java; backend/EZChat-app/src/main/java/hal/th50743/pojo/ForceLogoutBroadcastVO.java; frontend/vue-ezchat/src/WS/useWebsocket.ts; frontend/vue-ezchat/src/stores/websocketStore.ts; frontend/vue-ezchat/src/stores/userStore.ts; frontend/vue-ezchat/src/utils/validators.ts; frontend/vue-ezchat/src/type/index.ts; frontend/vue-ezchat/src/i18n/locales/en.json; frontend/vue-ezchat/src/i18n/locales/ja.json; frontend/vue-ezchat/src/i18n/locales/ko.json; frontend/vue-ezchat/src/i18n/locales/zh.json; frontend/vue-ezchat/src/i18n/locales/zh-tw.json

## [2026-01-09 19:15] Avatar LRU Cache
- **Goal**: Cache avatars by user/chat key to avoid repeated fetches while limiting memory.
- **Changes**: frontend/vue-ezchat/src/stores/imageStore.ts; frontend/vue-ezchat/src/stores/roomStore.ts; frontend/vue-ezchat/src/stores/userStore.ts

## [2026-01-09 19:18] Frontend Type Check
- **Goal**: Run frontend type-check.
- **Changes**: npm run type-check (failed with TS errors in notification.ts and useRoomBasicSettings.ts)

## [2026-01-09 19:19] Fix Type Check Errors
- **Goal**: Resolve TypeScript errors without changing behavior.
- **Changes**: frontend/vue-ezchat/src/components/notification.ts; frontend/vue-ezchat/src/composables/useRoomBasicSettings.ts

## [2026-01-09 19:23] Views Structure Cleanup
- **Goal**: Normalize views directory structure and import paths.
- **Changes**: frontend/vue-ezchat/src/views/layout/index.vue; frontend/vue-ezchat/src/views/chat/index.vue; frontend/vue-ezchat/src/router/index.ts; moved folders: frontend/vue-ezchat/src/views/layout/layout -> frontend/vue-ezchat/src/views/layout/sections; frontend/vue-ezchat/src/views/chat/layout -> frontend/vue-ezchat/src/views/chat/sections; frontend/vue-ezchat/src/views/Join -> frontend/vue-ezchat/src/views/join

## [2026-01-09 19:25] Room Settings Dialog Consolidation
- **Goal**: Consolidate room settings dialog and subviews into a single folder.
- **Changes**: frontend/vue-ezchat/src/components/dialogs/room-settings/index.vue; frontend/vue-ezchat/src/components/dialogs/room-settings/RoomInviteList.vue; frontend/vue-ezchat/src/components/dialogs/room-settings/RoomMemberManagement.vue; frontend/vue-ezchat/src/components/dialogs/room-settings/RoomBasicSettings.vue; frontend/vue-ezchat/src/components/dialogs/room-settings/RoomInviteCreate.vue; frontend/vue-ezchat/src/components/dialogs/room-settings/RoomPasswordSettings.vue; frontend/vue-ezchat/src/views/chat/sections/ChatHeader.vue; moved folder frontend/vue-ezchat/src/components/dialogs/settings -> frontend/vue-ezchat/src/components/dialogs/room-settings; moved frontend/vue-ezchat/src/components/dialogs/RoomSettingsDialog.vue -> frontend/vue-ezchat/src/components/dialogs/room-settings/index.vue
## [2026-01-10 09:04] User Settings Style Unification
- **Goal**: Unify User Settings input styles with Room Settings by adopting proper ELForm structure.
- **Changes**:
  - Refactored `ProfileTab.vue` to use `<el-form>` and `<el-form-item>`.
  - Refactored `SecurityTab.vue` to use `<el-form>` and `<el-form-item>` with error prop binding.
  - Removed custom CSS hacks for form items.
## [2026-01-10 14:20] Sync login member info in member list
- **Goal**: Keep chatMemberList aligned with updated LoginUserInfo after profile changes.
- **Changes**: frontend/vue-ezchat/src/stores/roomStore.ts (syncLoginMemberInfo), frontend/vue-ezchat/src/stores/userStore.ts (syncUserState call)
