# Tiered Method Naming Refactoring Plan

## Naming Convention Rules

### Mapper Layer (SQL Keywords)
| Operation | Prefix | Example |
|-----------|--------|---------|
| Create | `insert` | `insertUser`, `insertChat` |
| Read | `select` | `selectById`, `selectList` |
| Update | `update` | `updateStatus` |
| Delete | `delete` | `deleteById` |

### Service Layer (Business Semantics)
| Operation | Prefix | Use Case |
|-----------|--------|----------|
| Create | `create` | New entity with init logic |
| Create | `add` | Add relationship/item |
| Create | `save` | Insert or update |
| Read | `get` | Expected non-null |
| Read | `find` | May return null/Optional |
| Read | `list` | Return collection |
| Update | `update` | State changes |
| Delete | `remove` | Soft delete/relationship |
| Delete | `delete` | Physical deletion |

---

## Phase 1: Mapper Layer Refactoring

### 1.1 UserMapper (7 methods)

| # | Method | Current | New Name | Status |
|---|--------|---------|----------|--------|
| 1 | `add` | CREATE | `insertUser` | [ ] |
| 2 | `addFormalUser` | CREATE | `insertFormalUser` | [ ] |
| 3 | `getIdByUid` | READ | `selectIdByUid` | [ ] |
| 4 | `getUserVOById` | READ | `selectUserVOById` | [ ] |
| 5 | `getUserByUid` | READ | `selectUserByUid` | [ ] |
| 6 | `findByUidWithAvatar` | READ | `selectByUidWithAvatar` | [ ] |
| 7 | `findByIdWithAvatar` | READ | `selectByIdWithAvatar` | [ ] |
| 8 | `getUsernameByUserId` | READ | `selectUsernameByUserId` | [ ] |
| 9 | `getUserById` | READ | `selectUserById` | [ ] |

> **Keep unchanged**: `selectFormalUserByUsername`, `selectUserByUsername`, `selectByUid`, `update`, `updateLastSeenAt`

---

### 1.2 ChatMapper (4 methods)

| # | Current | New Name | Status |
|---|---------|----------|--------|
| 1 | `getChatIdByChatCode` | `selectChatIdByChatCode` | [ ] |
| 2 | `getChatVOListByUserId` | `selectChatVOListByUserId` | [ ] |
| 3 | `getChatVOByChatId` | `selectChatVOByChatId` | [ ] |
| 4 | `getJoinInfoByChatId` | `selectJoinInfoByChatId` | [ ] |
| 5 | `addChat` | `insertChat` | [ ] |
| 6 | `getChatIdByInviteCodeHash` | `selectChatIdByInviteCodeHash` | [ ] |

> **Keep unchanged**: `isValidChatId` (boolean validation)

---

### 1.3 ChatMemberMapper (6 methods)

| # | Current | New Name | Status |
|---|---------|----------|--------|
| 1 | `getChatMembersById` | `selectChatMembersById` | [ ] |
| 2 | `getChatMembersByUserIdAndChatId` | `selectChatMembersByUserIdAndChatId` | [ ] |
| 3 | `getChatMemberListByUserId` | `selectChatMemberListByUserId` | [ ] |
| 4 | `getChatMemberLiteListByUserId` | `selectChatMemberLiteListByUserId` | [ ] |
| 5 | `getChatMemberListByChatId` | `selectChatMemberListByChatId` | [ ] |
| 6 | `add` | `insertChatMember` | [ ] |

> **Keep unchanged**: `isValidGetInfoReq`, `updateLastSeenAt`

---

### 1.4 MessageMapper (5 methods)

| # | Current | New Name | Status |
|---|---------|----------|--------|
| 1 | `addMessage` | `insertMessage` | [ ] |
| 2 | `getUnreadCountMapByUserId` | `selectUnreadCountMapByUserId` | [ ] |
| 3 | `getUnreadCountMapByUserIdAndChatId` | `selectUnreadCountMapByUserIdAndChatId` | [ ] |
| 4 | `getLastMessageListByUserId` | `selectLastMessageListByUserId` | [ ] |
| 5 | `getLastMessageByChatId` | `selectLastMessageByChatId` | [ ] |
| 6 | `getMessageListByChatIdAndTimeStamp` | `selectMessageListByChatIdAndTimeStamp` | [ ] |

---

### 1.5 AssetMapper (6 methods)

| # | Current | New Name | Status |
|---|---------|----------|--------|
| 1 | `add` | `insertAsset` | [ ] |
| 2 | `findById` | `selectById` | [ ] |
| 3 | `findByObjectName` | `selectByObjectName` | [ ] |
| 4 | `findByMessageId` | `selectByMessageId` | [ ] |
| 5 | `findPendingFilesBefore` | `selectPendingFilesBefore` | [ ] |
| 6 | `findByRawHashAndActive` | `selectByRawHashAndActive` | [ ] |
| 7 | `findByNormalizedHashAndActive` | `selectByNormalizedHashAndActive` | [ ] |

> **Keep unchanged**: `updateStatusBatch`, `updateStatusAndCategory`, `updateStatus`, `deleteById`, `deleteByIds`

---

### 1.6 ChatInviteMapper (1 method)

| # | Current | New Name | Status |
|---|---------|----------|--------|
| 1 | `add` | `insertChatInvite` | [ ] |
| 2 | `findByCodeHash` | `selectByCodeHash` | [ ] |

> **Keep unchanged**: `consume` (special update), `deleteByCodeHash`

---

### 1.7 OperationLogMapper (1 method)

| # | Current | New Name | Status |
|---|---------|----------|--------|
| 1 | `add` | `insertLog` | [ ] |

---

## Phase 2: XML Mapper Updates

For each renamed method, update corresponding `<id>` in XML files:

- [ ] `UserMapper.xml`
- [ ] `ChatMapper.xml`
- [ ] `ChatMemberMapper.xml`
- [ ] `MessageMapper.xml`
- [ ] `AssetMapper.xml`
- [ ] `ChatInviteMapper.xml`
- [ ] `OperationLogMapper.xml`

---

## Phase 3: Service Layer Refactoring

### 3.1 UserService

| # | Current | New Name | Reason | Status |
|---|---------|----------|--------|--------|
| 1 | `add` | `createUser` | New entity creation | [ ] |

> **Keep unchanged**: `getIdByUid`, `update`, `uploadAvatar`, `getUserInfoByUid`, `updateLastSeenAt`, `getUsernameByUserId`, `getUserById`

---

### 3.2 ChatService

| # | Current | New Name | Reason | Status |
|---|---------|----------|--------|--------|
| 1 | `join` | `addMember` | Adding relationship | [ ] |

> **Keep unchanged**: Most methods use `get*` which is correct

---

### 3.3 MessageService

| # | Current | New Name | Reason | Status |
|---|---------|----------|--------|--------|
| 1 | `addMessage` | `saveMessage` | Complex save operation | [ ] |

> **Alternatively keep `addMessage`** as it adds to collection

---

### 3.4 AssetService

| # | Current | New Name | Reason | Status |
|---|---------|----------|--------|--------|
| 1 | `findPendingFilesForGC` | `listPendingFilesForGC` | Returns collection | [ ] |
| 2 | `findActiveObjectByRawHash` | `findByRawHash` | May return null | [ ] |
| 3 | `findActiveObjectByNormalizedHash` | `findByNormalizedHash` | May return null | [ ] |
| 4 | `findById` | Keep as-is | May return null | [ ] |
| 5 | `findByObjectName` | Keep as-is | May return null | [ ] |

---

## Phase 4: Update Service Implementations + Callers

Update all `*ServiceImpl.java` to use new Mapper method names.

---

## Phase 5: Update LogAspect Pointcut

Update `LogAspect.java` to match new naming convention:

```java
@Pointcut("execution(* hal.th50743.service.impl.*ServiceImpl.create*(..)) || " +
          "execution(* hal.th50743.service.impl.*ServiceImpl.add*(..)) || " +
          "execution(* hal.th50743.service.impl.*ServiceImpl.save*(..)) || " +
          "execution(* hal.th50743.service.impl.*ServiceImpl.update*(..)) || " +
          "execution(* hal.th50743.service.impl.*ServiceImpl.remove*(..)) || " +
          "execution(* hal.th50743.service.impl.*ServiceImpl.delete*(..))")
public void cudOperations() {}
```

---

## Verification Plan

### Automated Verification
```bash
cd /home/dev/EZChat/backend/EZChat-app
mvn compile -q
```

### Manual Verification
1. Start the backend application
2. Test login/register flow
3. Test create chat room
4. Test join chat room
5. Check `operation_log` table for correct entries